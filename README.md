# 智能自动跟随书包 🎒

一个五年级学生的科技创新项目 - 让书包自动跟着你走！

## 📋 项目简介

这是一个智能自动跟随书包系统，书包固定在带轮底盘上，通过UWB超宽带定位技术实现自动跟随人行走的功能，解决小学生书包过重的问题。

## 🚀 功能模式

| 模式 | 名称 | 功能描述 |
|------|------|----------|
| 0 | 待机模式 | 显示书包重量，超重时提醒 |
| 1 | 背负模式 | MPU6050检测弯腰、驼背、高低肩 |
| 2 | 自跟随模式 | UWB定位，小车自动跟随人移动 |
| 3 | 手拉车模式 | 所有传感器停止，纯手动拉车 |
| 4 | 归位模式 | 按照示教路径自动归位 |
| 5 | 路径示教模式 | 蓝牙连接手机APP遥控，记录路径 |

## 🔧 硬件清单

### 主控
- ESP32 Dev Module

### 传感器
- **UWB模块**: MK8000TR7.9-GC × 3
  - 1个主机（佩戴在人身上）
  - 2个从机（安装在小车前端）
- **陀螺仪**: MPU6050 (I2C)
- **称重模块**: HX711 + 压力传感器

### 执行器
- **电机驱动**: L298N
- **电机**: 12V直流减速电机 × 2

### 显示与交互
- **显示屏**: SSD1306 OLED 0.96寸 (I2C)
- **按钮**: 轻触按钮 × 1 (短按切换模式，长按控制LED)
- **蜂鸣器**: 有源蜂鸣器 (姿态异常提醒)
- **LED灯条**: WS2812/5050灯条 (夜间照明)

### 电源
- UPS电池模块 (12V + 5V输出)

## 📁 项目结构

```
uwbshubao/
├── src/
│   ├── main.cpp          # 主程序
│   ├── config.h          # 配置文件（引脚定义、参数）
│   ├── display.h/.cpp    # OLED显示模块
│   ├── motor.h/.cpp      # 电机控制模块
│   ├── uwb.h/.cpp        # UWB通信模块
│   ├── imu.h/.cpp        # MPU6050姿态检测
│   ├── weight.h/.cpp     # HX711称重模块
│   ├── follow.h/.cpp     # 自动跟随算法
│   └── path.h/.cpp       # 路径示教与归位
├── platformio.ini        # PlatformIO配置
└── README.md             # 本文件
```

## 🔌 接线说明

### ESP32 引脚分配

| 模块 | ESP32引脚 | 说明 |
|------|-----------|------|
| UWB从机0 RX | GPIO16 | Serial2 |
| UWB从机0 TX | GPIO17 | Serial2 |
| UWB从机1 RX | GPIO27 | Serial1 |
| UWB从机1 TX | GPIO26 | Serial1 |
| L298N IN1 | GPIO13 | 左电机正转 |
| L298N IN2 | GPIO12 | 左电机反转 |
| L298N IN3 | GPIO14 | 右电机正转 |
| L298N IN4 | GPIO25 | 右电机反转 |
| L298N ENA | GPIO32 | 左电机PWM |
| L298N ENB | GPIO33 | 右电机PWM |
| I2C SDA | GPIO21 | MPU6050 + SSD1306 |
| I2C SCL | GPIO22 | MPU6050 + SSD1306 |
| HX711 DOUT | GPIO18 | 数据 |
| HX711 SCK | GPIO19 | 时钟 |
| 按钮 | GPIO4 | 短按切换模式，长按控制LED |
| 蜂鸣器 | 待定 | 有源蜂鸣器 |
| LED灯条 | 待定 | 夜间照明 |

## 📱 串口/蓝牙命令

### 调试命令
| 命令 | 功能 |
|------|------|
| W | 前进 |
| S | 后退 |
| A | 左转 |
| D | 右转 |
| X | 停止 |
| M | 切换模式 |
| T | 称重去皮 |
| C | IMU校准 |
| ? | 帮助 |

### 路径示教命令（模式5）
| 命令 | 功能 |
|------|------|
| P | 开始记录路径 |
| E | 结束记录路径 |
| F | 前进 |
| B | 后退 |
| L | 左转 |
| R | 右转 |
| S | 停止 |

## 🛠️ 编译与上传

1. 安装 [PlatformIO](https://platformio.org/)（推荐使用VSCode插件）
2. 打开项目文件夹
3. 点击 PlatformIO 侧边栏的 **Build** 编译
4. 点击 **Upload** 上传到 ESP32
5. 点击 **Monitor** 查看串口输出

## 📝 UWB模块配置

### 人身上的UWB（主机）
```
AT+MODE=0
AT+ROLE=1
AT+PID=255
AT+PERIOD=5
AT+MADDR=0000
AT+SADDR0=0001
AT+SADDR1=0002
AT+UART=115200
AT+RST
```

### 小车右前方UWB（从机0）
```
AT+MODE=0
AT+ROLE=0
AT+PID=255
AT+PERIOD=5
AT+MADDR=0001
AT+SADDR0=0000
AT+UART=115200
AT+RST
```

### 小车左前方UWB（从机1）
```
AT+MODE=0
AT+ROLE=0
AT+PID=255
AT+PERIOD=5
AT+MADDR=0002
AT+SADDR0=0000
AT+UART=115200
AT+RST
```

## ✅ 测试清单

### 基础硬件测试
- [ ] ESP32能正常上电启动
- [ ] OLED显示正常
- [ ] 按钮短按能切换模式
- [ ] 按钮长按能控制LED灯条
- [ ] 电机能正反转
- [ ] 蜂鸣器能发声
- [ ] LED灯条能点亮和关闭

### 传感器测试
- [ ] HX711能读取重量
- [ ] MPU6050能读取姿态
- [ ] UWB从机0能收到距离数据
- [ ] UWB从机1能收到距离数据

### 功能测试
- [ ] 跟随模式能正常工作
- [ ] 姿态异常时蜂鸣器能响
- [ ] 路径示教能记录
- [ ] 归位能执行
- [ ] 蓝牙能连接手机（待实现）

## 📄 许可证

MIT License

---

**Happy Coding! 🎉**
