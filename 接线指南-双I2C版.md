# 智能自动跟随书包 - 双 I2C 接线指南

本文档基于当前固件与引脚配置整理，确保接线与实际代码一致。

## 一、引脚总览

| 模块 | 引脚 | 说明 |
|---|---|---|
| OLED (I2C0) | SDA=GPIO21 / SCL=GPIO22 | 屏幕显示
| MPU6050 (I2C1) | SDA=GPIO25 / SCL=GPIO26 | 姿态检测
| UWB0 | RX=GPIO16 / TX=GPIO17 | 主机串口2
| UWB1 | RX=GPIO27 / TX=GPIO13 | 从机串口1
| L298N | IN1=GPIO5 / IN2=GPIO14 / IN3=GPIO32 / IN4=GPIO33 | PWM 调速
| HX711 | DOUT=GPIO18 / SCK=GPIO19 | 称重
| 按钮 | GPIO4 | 单击/双击/长按
| 蜂鸣器 | GPIO23 | 低电平有效
| WS2812 | GPIO12 | 30 颗灯珠

---

## 二、各模块接线

### 1) OLED (SSD1306)

```
SSD1306          ESP32
VCC   ─────────> 3.3V
GND   ─────────> GND
SDA   ─────────> GPIO21 (I2C0 SDA)
SCL   ─────────> GPIO22 (I2C0 SCL)
```

### 2) MPU6050

```
MPU6050          ESP32
VCC   ─────────> 3.3V
GND   ─────────> GND
SDA   ─────────> GPIO25 (I2C1 SDA)
SCL   ─────────> GPIO26 (I2C1 SCL)
```

### 3) UWB 模块 ×2

- UWB0（主机）
```
UWB0             ESP32
VCC   ─────────> 3.3V
GND   ─────────> GND
RX    ─────────> GPIO16
TX    ─────────> GPIO17
```

- UWB1（从机）
```
UWB1             ESP32
VCC   ─────────> 3.3V
GND   ─────────> GND
RX    ─────────> GPIO27
TX    ─────────> GPIO13
```

### 4) L298N 电机驱动（PWM 调速）

关键点：
- ENA/ENB **保持跳线帽接 5V（不接 ESP32）**
- PWM 调速通过 IN1/IN2/IN3/IN4 完成

```
L298N            ESP32
IN1   ─────────> GPIO5   (左电机正转)
IN2   ─────────> GPIO14  (左电机反转)
IN3   ─────────> GPIO32  (右电机正转)
IN4   ─────────> GPIO33  (右电机反转)
ENA   ─────────> 跳线帽接 5V
ENB   ─────────> 跳线帽接 5V
GND   ─────────> GND
12V   ─────────> UPS 12V 输出
```

### 5) HX711

```
HX711            ESP32
VCC   ─────────> 5V
GND   ─────────> GND
DT    ─────────> GPIO18
SCK   ─────────> GPIO19
```

### 6) 按钮

```
按钮             ESP32
一端 ─────────> GPIO4 (内部上拉)
另一端 ───────> GND
```

### 7) 蜂鸣器（低电平有效）

```
蜂鸣器           ESP32
VCC  ─────────> 5V
GND  ─────────> GND
SIG  ─────────> GPIO23
```

### 8) WS2812 灯带

```
WS2812           ESP32
VCC   ─────────> 5V (建议 UPS 5V 输出)
GND   ─────────> GND
DIN   ─────────> GPIO12
```

- 默认 30 颗灯珠
- 建议数据线上串联 330~470Ω 电阻

---

## 三、电源分配

```
UPS 电源
├── 12V 输出 ──→ L298N
└── 5V 输出  ──→ ESP32 VIN
                 ├── 3.3V ──→ OLED / MPU6050 / UWB
                 └── 5V   ──→ HX711 / WS2812
```

---

## 四、重要注意事项

- OLED 使用 I2C0，MPU6050 使用 I2C1，两者不要接错
- L298N ENA/ENB 跳线帽保持接 5V
- 所有模块必须共地
- WS2812 建议使用稳定 5V 供电，灯珠多时注意电流

---

## 五、故障排查

| 问题 | 可能原因 | 解决方法 |
|---|---|---|
| OLED 无显示 | I2C 接错 | 检查 GPIO21/22 |
| MPU6050 无响应 | I2C 接错 | 检查 GPIO25/26 |
| UWB 无数据 | 串口接错 | 核对 UWB RX/TX |
| 电机不转 | ENA/ENB 未接 5V 或未共地 | 检查跳线帽与地线 |
| 灯带不亮 | DIN 引脚/供电错误 | 检查 GPIO12 与 5V |

---

## 六、测试清单

- [ ] 上电后 OLED 正常显示
- [ ] 按钮单击可切换模式
- [ ] 按钮双击进入归位
- [ ] 按钮长按切换灯带
- [ ] 跟随模式正常移动
- [ ] 示教/归位可用
