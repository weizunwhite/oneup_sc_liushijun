# 智能自动跟随书包 - 双I2C接线指南

## 🔧 硬件连接图

### ESP32 引脚分布（仅显示已使用引脚）

```
ESP32 Dev Module (36 pins)
┌─────────────────────────────────────┐
│                                     │
│  GPIO4  ●────── 按钮开关            │
│  GPIO2  ●────── 电机ENB (PWM)       │
│                                     │
│  GPIO12 ●────── 电机IN1             │
│  GPIO13 ●────── UWB1 TX             │
│  GPIO14 ●────── 电机IN2             │
│  GPIO15 ●────── 电机ENA (PWM)       │
│                                     │
│  GPIO16 ●────── UWB0 RX             │
│  GPIO17 ●────── UWB0 TX             │
│  GPIO18 ●────── HX711 DOUT          │
│  GPIO19 ●────── HX711 SCK           │
│                                     │
│  GPIO21 ●────── OLED SDA (I2C0)     │
│  GPIO22 ●────── OLED SCL (I2C0)     │
│                                     │
│  GPIO25 ●────── MPU6050 SDA (I2C1)  │
│  GPIO26 ●────── MPU6050 SCL (I2C1)  │
│  GPIO27 ●────── UWB1 RX             │
│                                     │
│  GPIO32 ●────── 电机IN3             │
│  GPIO33 ●────── 电机IN4             │
│                                     │
│  VIN    ●────── UPS 5V 输出         │
│  3.3V   ●────── UWB/MPU/OLED VCC    │
│  GND    ●────── 公共地              │
└─────────────────────────────────────┘
```

---

## 📋 逐个模块接线

### 1. OLED 显示屏 (SSD1306, 0.96寸)

**使用 I2C0 总线（独立）**

```
SSD1306          ESP32
┌─────────┐    ┌─────────┐
│   VCC   ├────┤  3.3V   │
│   GND   ├────┤   GND   │
│   SDA   ├────┤ GPIO21  │ I2C0 SDA
│   SCL   ├────┤ GPIO22  │ I2C0 SCL
└─────────┘    └─────────┘
```

---

### 2. MPU6050 陀螺仪/加速度计

**使用 I2C1 总线（独立）**

```
MPU6050          ESP32
┌─────────┐    ┌─────────┐
│   VCC   ├────┤  3.3V   │
│   GND   ├────┤   GND   │
│   SDA   ├────┤ GPIO25  │ I2C1 SDA
│   SCL   ├────┤ GPIO26  │ I2C1 SCL
└─────────┘    └─────────┘
```

⚠️ **重要：与旧版不同，不再与OLED共用I2C！**

---

### 3. UWB 模块 ×2

#### UWB从机0 (标签0, 小车右前方)

```
UWB0             ESP32
┌─────────┐    ┌─────────┐
│   VCC   ├────┤  3.3V   │
│   GND   ├────┤   GND   │
│ GPIO1   ├────┤ GPIO16  │ Serial2 RX
│ GPIO0   ├────┤ GPIO17  │ Serial2 TX
└─────────┘    └─────────┘
```

#### UWB从机1 (标签1, 小车左前方)

```
UWB1             ESP32
┌─────────┐    ┌─────────┐
│   VCC   ├────┤  3.3V   │
│   GND   ├────┤   GND   │
│ GPIO1   ├────┤ GPIO27  │ Serial1 RX
│ GPIO0   ├────┤ GPIO13  │ Serial1 TX
└─────────┘    └─────────┘
```

---

### 4. L298N 电机驱动 (全速模式)

**⚠️ 关键配置：**
- **必须插上 ENA 和 ENB 的跳线帽！**
- **不连接 ESP32 的 GPIO15 和 GPIO2**
- **IN1 接到 GPIO5 (这是为了避免GPIO12启动冲突)**

```
L298N            ESP32
┌─────────┐    ┌─────────┐
│   IN1   ├────┤ GPIO5   │ 左电机正转 (新引脚!)
│   IN2   ├────┤ GPIO14  │ 左电机反转
│   IN3   ├────┤ GPIO32  │ 右电机正转
│   IN4   ├────┤ GPIO33  │ 右电机反转
│   ENA   ├──[跳线帽接5V] (不接ESP32)
│   ENB   ├──[跳线帽接5V] (不接ESP32)
│   GND   ├────┤   GND   │ 必须共地
│   12V   ├────  UPS 12V输出
│  +5V    ├────  (悬空或供电给其他5V设备)
└─────────┘    └─────────┘
```

---

### 5. HX711 称重模块

```
HX711            ESP32
┌─────────┐    ┌─────────┐
│   VCC   ├────┤   5V    │ (VIN引脚)
│   GND   ├────┤   GND   │
│   DT    ├────┤ GPIO18  │ 数据
│   SCK   ├────┤ GPIO19  │ 时钟
└─────────┘    └─────────┘

    ├──── 称重传感器 ────┤
       (四线应变片)
```

---

### 6. 按钮开关

```
按钮             ESP32
┌─────────┐    ┌─────────┐
│  一端   ├────┤ GPIO4   │ (内部上拉)
│  另一端 ├────┤   GND   │
└─────────┘    └─────────┘
```

---

## ⚡ 电源分配

```
UPS电源
├── 12V 输出 ──→ L298N (电机驱动)
└── 5V 输出  ──→ ESP32 VIN
                 │
                 ├── 3.3V ──→ OLED, MPU6050, UWB×2
                 └── 5V   ──→ HX711
```

---

## ⚠️ 重要注意事项

### 1. I2C 总线隔离
- ✅ OLED 使用 I2C0 (GPIO21/22)
- ✅ MPU6050 使用 I2C1 (GPIO25/26)
- ❌ 两者不能接错，否则会冲突

### 2. 电机驱动跳线
- L298N 的 ENA/ENB 跳线帽需要**移除**
- 才能通过 GPIO15/GPIO2 PWM调速

### 3. 串口引脚
- Serial2 (UWB0): RX=16, TX=17 (硬件串口)
- Serial1 (UWB1): RX=27, TX=13 (软件重映射)

### 4. 共地连接
- 所有模块的 GND 必须连接到一起
- 特别是 L298N 和 ESP32

---

## 🔍 故障排查

| 问题 | 可能原因 | 解决方法 |
|------|---------|---------|
| OLED显示卡顿 | MPU6050连错I2C | 检查MPU6050是否接GPIO25/26 |
| MPU6050无响应 | 使用了旧I2C引脚 | 改接GPIO25/26 |
| UWB无数据 | 串口引脚错误 | 核对UWB1是否接GPIO13/27 |
| 电机不转 | ENA/ENB跳线未拔 | 移除L298N上的跳线帽 |
| 系统重启 | 电源不足 | 检查UPS容量，至少2A |

---

## ✅ 测试清单

接线完成后，逐个测试：

- [ ] 上电后 OLED 显示启动画面
- [ ] 串口输出 "显示屏初始化完成 (I2C0)"
- [ ] 串口输出 "陀螺仪初始化完成 (I2C1)"
- [ ] 按按钮可以切换模式
- [ ] 模式1下显示角度数据（倾斜设备观察）
- [ ] 发送串口命令 `I` 显示IMU数据
- [ ] 发送串口命令 `C` IMU校准成功

---

**接线完成后，将陀螺仪的旧线从 GPIO21/22 改接到 GPIO25/26 即可！**
